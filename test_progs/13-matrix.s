.set noat

C = 0x1000
A = 8
B = 520

nop
br start

.quad 1,10,14,3,11,2,16,15		/* Matrix A */
.quad 11,8,5,15,13,9,4,2
.quad 14,10,11,16,4,9,1,7
.quad 15,16,2,14,4,11,5,3
.quad 13,7,14,6,1,4,15,3
.quad 5,6,9,1,16,11,12,13
.quad 16,5,14,15,2,10,6,11
.quad 10,13,6,15,1,5,3,12

.quad 11,7,13,8,9,3,1,6			/* Matrix B */
.quad 14,3,6,12,15,5,11,16
.quad 7,13,11,10,6,1,15,3
.quad 9,13,10,8,15,4,5,2
.quad 1,15,5,10,14,9,13,7
.quad 13,5,9,8,14,15,12,1
.quad 5,1,10,9,7,11,12,14
.quad 4,13,9,7,1,10,12,6

start:
lda $r1, 0x7
loop1:
	lda $r2, 0x7
	loop2:
		lda $r3, 0x7
		loop3:
			mulq $r1, 0x8, $r4
			addq $r4, $r2, $r5		/* <- i*SZ+j */
			mulq $r5, 0x8, $r5
			addq $r4, $r3, $r6		/* <- i*SZ+k */
			mulq $r6, 0x8, $r6
			mulq $r3, 0x8, $r4
			addq $r4, $r2, $r7		/* <- k*SZ+j */
			mulq $r7, 0x8, $r7
			ldq  $r8,  B($r7)		/* <- B(k,j) */
			ldq  $r9,  A($r6)		/* <- A(i,k) */
			ldq  $r10, C($r5)		/* <- C(i,j) */
			mulq $r8, $r9, $r8		/* <- A*B */
			addq $r10, $r8, $r8		/* C(i,j) += A*B */
			stq  $r8, C($r5)
			subq $r3, 0x1, $r3		/* --k */
			bge $r3, loop3
		subq $r2, 0x1, $r2			/* --j */
		bge $r2, loop2
	subq $r1, 0x1, $r1				/* --i */
	bge $r1, loop1
call_pal 0x555

/* Result should be:
453 644 625 667 597 534 875 607
561 631 600 606 812 454 598 407
669 676 697 640 778 419 625 402
713 520 649 638 845 469 571 507
533 461 643 574 574 376 607 483
482 659 626 657 679 629 851 524
685 733 801 679 749 491 706 422
598 581 612 577 663 398 571 442
*/
